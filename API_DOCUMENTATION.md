# 绿色智能船艇农文旅平台 - API文档

## 📋 概述

本API为绿色智能船艇农文旅平台提供完整的后端服务，支持用户、商家、船员、管理员四种角色的全生命周期管理。

## 🚀 技术栈

- **框架**: FastAPI 0.104.1
- **数据库**: MySQL
- **ORM**: SQLAlchemy 2.0.23
- **认证**: JWT (JSON Web Tokens)
- **密码加密**: bcrypt
- **API文档**: Swagger/OpenAPI

## 👥 用户角色

1. **管理员 (Admin)** - 平台管理权限
2. **商家 (Merchant)** - 船艇服务提供商
3. **用户 (User)** - 普通游客用户
4. **船员 (Crew)** - 船艇操作人员

## 🔐 认证系统 `/api/v1/auth`

### 用户注册
- **POST** `/register` - 用户注册
- **权限**: 公开
- **说明**: 创建新用户账户

### 用户登录
- **POST** `/login` - 用户登录
- **权限**: 公开
- **说明**: 验证用户凭证并返回JWT令牌

### 获取当前用户信息
- **GET** `/me` - 获取当前用户信息
- **权限**: 需要登录
- **说明**: 返回当前登录用户的详细信息

### 用户登出
- **POST** `/logout` - 用户登出
- **权限**: 需要登录
- **说明**: 注销当前用户会话

## 👤 用户管理 `/api/v1/users`

### 更新个人信息
- **PUT** `/me` - 更新当前用户信息
- **权限**: 需要登录
- **说明**: 用户更新自己的个人信息

### 获取用户详情
- **GET** `/{user_id}` - 获取用户详情
- **权限**: 管理员/商家
- **说明**: 查看指定用户的详细信息

### 更新用户信息
- **PUT** `/{user_id}` - 更新用户信息
- **权限**: 管理员
- **说明**: 管理员更新任意用户信息

## 🏢 商家管理 `/api/v1/merchants`

### 创建商家信息
- **POST** `/` - 创建商家信息
- **权限**: 管理员/商家
- **说明**: 创建或完善商家资料

### 获取商家列表
- **GET** `/` - 获取商家列表
- **权限**: 管理员
- **说明**: 分页查询所有商家，支持筛选和搜索

### 获取我的商家信息
- **GET** `/me` - 获取当前用户的商家信息
- **权限**: 需要登录
- **说明**: 获取当前登录用户的商家详情

### 获取商家详情
- **GET** `/{merchant_id}` - 获取商家详情
- **权限**: 管理员/商家本人
- **说明**: 查看指定商家的详细信息

### 更新商家信息
- **PUT** `/me` - 更新当前用户的商家信息
- **PUT** `/{merchant_id}` - 更新商家信息(管理员)
- **权限**: 商家本人/管理员
- **说明**: 更新商家资料信息

### 商家认证
- **POST** `/{merchant_id}/verify` - 认证商家
- **权限**: 管理员
- **说明**: 管理员审核并认证商家资质

### 激活/停用商家
- **POST** `/{merchant_id}/activate` - 激活/停用商家
- **权限**: 管理员
- **说明**: 管理员控制商家账户状态

### 删除商家
- **DELETE** `/{merchant_id}` - 删除商家
- **权限**: 管理员
- **说明**: 删除商家账户

## ⚓ 船员管理 `/api/v1/crews`

### 创建船员信息
- **POST** `/` - 创建船员信息
- **权限**: 管理员/船员
- **说明**: 创建或完善船员资料

### 获取船员列表
- **GET** `/` - 获取船员列表
- **权限**: 管理员
- **说明**: 分页查询所有船员，支持筛选

### 获取可用船员
- **GET** `/available` - 获取可用船员列表
- **权限**: 管理员/商家
- **说明**: 查询当前可用的船员

### 获取我的船员信息
- **GET** `/me` - 获取当前用户的船员信息
- **权限**: 需要登录
- **说明**: 获取当前登录用户的船员详情

### 获取船员详情
- **GET** `/{crew_id}` - 获取船员详情
- **权限**: 管理员/商家/船员本人
- **说明**: 查看指定船员的详细信息

### 更新船员信息
- **PUT** `/me` - 更新当前用户的船员信息
- **PUT** `/{crew_id}` - 更新船员信息(管理员)
- **权限**: 船员本人/管理员
- **说明**: 更新船员资料信息

### 更新船员状态
- **PUT** `/{crew_id}/status` - 更新船员状态
- **权限**: 管理员/商家/船员本人
- **说明**: 更新船员工作状态

### 船员评分
- **PUT** `/{crew_id}/rating` - 更新船员评分
- **权限**: 管理员/商家
- **说明**: 对船员服务进行评分

### 删除船员
- **DELETE** `/{crew_id}` - 删除船员
- **权限**: 管理员
- **说明**: 删除船员账户

## 🚤 船艇管理 `/api/v1/boats`

### 创建船艇信息
- **POST** `/` - 创建船艇信息
- **权限**: 管理员/商家
- **说明**: 添加新船艇到系统

### 获取船艇列表
- **GET** `/` - 获取船艇列表
- **权限**: 管理员
- **说明**: 分页查询所有船艇，支持筛选

### 获取可用船艇
- **GET** `/available` - 获取可用船艇列表
- **权限**: 需要登录
- **说明**: 查询当前可用的船艇

### 获取我的船艇
- **GET** `/my` - 获取当前商家的船艇列表
- **权限**: 商家
- **说明**: 商家查看自己的船艇

### 获取船艇详情
- **GET** `/{boat_id}` - 获取船艇详情
- **权限**: 根据角色而定
- **说明**: 查看指定船艇的详细信息

### 更新船艇信息
- **PUT** `/{boat_id}` - 更新船艇信息
- **权限**: 管理员/船艇所有商家
- **说明**: 更新船艇基本信息

### 更新船艇状态
- **PUT** `/{boat_id}/status` - 更新船艇状态
- **权限**: 管理员/商家/船员
- **说明**: 更新船艇使用状态

### 更新船艇位置
- **PUT** `/{boat_id}/location` - 更新船艇位置
- **权限**: 管理员/商家/船员
- **说明**: 更新船艇当前位置

### 删除船艇
- **DELETE** `/{boat_id}` - 删除船艇
- **权限**: 管理员/船艇所有商家
- **说明**: 删除船艇记录

## 🛠️ 管理员功能 `/api/v1/admin`

### 仪表板
- **GET** `/dashboard` - 获取管理员仪表板数据
- **权限**: 管理员
- **说明**: 获取平台统计数据和概览信息

### 用户管理
- **GET** `/users` - 获取所有用户列表
- **GET** `/users/{user_id}` - 获取用户详情
- **PUT** `/users/{user_id}` - 更新用户信息
- **PUT** `/users/{user_id}/status` - 更新用户状态
- **PUT** `/users/{user_id}/role` - 更新用户角色
- **PUT** `/users/{user_id}/verify` - 验证用户
- **权限**: 管理员
- **说明**: 完整的用户管理功能

### 系统统计
- **GET** `/system/stats` - 获取系统统计信息
- **权限**: 管理员
- **说明**: 获取详细的系统统计数据

## 📊 数据模型

### 用户角色枚举
```python
UserRole:
- ADMIN = "admin"          # 管理员
- MERCHANT = "merchant"    # 商家
- USER = "user"           # 普通用户
- CREW = "crew"           # 船员
```

### 用户状态枚举
```python
UserStatus:
- ACTIVE = "active"       # 激活
- INACTIVE = "inactive"   # 未激活
- SUSPENDED = "suspended" # 暂停
- DELETED = "deleted"     # 已删除
```

### 船艇类型枚举
```python
BoatType:
- TOURIST = "tourist"     # 观光船
- FISHING = "fishing"     # 渔船
- CARGO = "cargo"        # 货船
- SPEEDBOAT = "speedboat" # 快艇
```

### 船艇状态枚举
```python
BoatStatus:
- AVAILABLE = "available"     # 可用
- IN_USE = "in_use"          # 使用中
- MAINTENANCE = "maintenance" # 维护中
- OUT_OF_SERVICE = "out_of_service"  # 停用
```

## 🔧 API 响应格式

### 成功响应
```json
{
    "success": true,
    "message": "操作成功",
    "data": { ... }
}
```

### 分页响应
```json
{
    "items": [ ... ],
    "total": 100,
    "page": 1,
    "page_size": 20,
    "pages": 5
}
```

### 错误响应
```json
{
    "success": false,
    "message": "错误描述",
    "data": null
}
```

## 🚀 快速开始

### 1. 启动服务
```bash
pip install -r requirements.txt
python main.py
```

### 2. 访问API文档
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 3. 注册管理员账户
```bash
POST /api/v1/auth/register
{
    "username": "admin",
    "email": "admin@example.com",
    "password": "admin123",
    "role": "admin"
}
```

### 4. 登录获取Token
```bash
POST /api/v1/auth/login
{
    "username": "admin",
    "password": "admin123"
}
```

## 📝 注意事项

1. **认证方式**: 使用JWT Bearer Token
2. **权限控制**: 基于用户角色的权限管理
3. **数据验证**: 使用Pydantic进行输入验证
4. **分页查询**: 支持page和page_size参数
5. **搜索功能**: 支持关键词模糊搜索
6. **状态管理**: 完整的状态流转控制

## 🛡️ 安全特性

- JWT令牌认证
- 密码哈希存储
- 角色权限控制
- 输入数据验证
- SQL注入防护
- CORS跨域支持

## 📞 技术支持

如有问题，请查看：
- API文档: `/docs`
- 健康检查: `/health`
- 系统信息: `/api/info` 